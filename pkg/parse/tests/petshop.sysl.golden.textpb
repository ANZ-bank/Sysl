apps: <
  key: "PetShopApi"
  value: <
    name: <
      part: "PetShopApi"
    >
    attrs: <
      key: "package"
      value: <
        s: "io.sysl.demo.petshop.api"
      >
    >
    endpoints: <
      key: "GET /petshop"
      value: <
        name: "GET /petshop"
        attrs: <
          key: "patterns"
          value: <
            a: <
              elt: <
                s: "rest"
              >
            >
          >
        >
        stmt: <
          ret: <
            payload: "PetShop"
          >
        >
        rest_params: <
          method: GET
          path: "/petshop"
        >
      >
    >
    types: <
      key: "Breed"
      value: <
        tuple: <
          attr_defs: <
            key: "avgLifespan"
            value: <
              primitive: DECIMAL
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 56
                  col: 23
                >
                end: <
                  line: 56
                  col: 30
                >
              >
            >
          >
          attr_defs: <
            key: "index"
            value: <
              primitive: INT
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "xml_attribute"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 57
                  col: 17
                >
                end: <
                  line: 57
                  col: 36
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 53
                  col: 16
                >
                end: <
                  line: 53
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "pets"
            value: <
              set: <
                type_ref: <
                  context: <
                    appname: <
                      part: "PetShopApi"
                    >
                    path: "Breed"
                  >
                  ref: <
                    path: "Pet"
                  >
                >
                source_context: <
                  file: "tests/petshop.sysl"
                  start: <
                    line: 55
                    col: 16
                  >
                  end: <
                    line: 55
                    col: 23
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 55
                  col: 16
                >
                end: <
                  line: 55
                  col: 23
                >
              >
            >
          >
          attr_defs: <
            key: "species"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 54
                  col: 19
                >
                end: <
                  line: 54
                  col: 25
                >
              >
            >
          >
        >
      >
    >
    types: <
      key: "Employee"
      value: <
        tuple: <
          attr_defs: <
            key: "dob"
            value: <
              primitive: DATE
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 49
                  col: 15
                >
                end: <
                  line: 49
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "index"
            value: <
              primitive: INT
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "xml_attribute"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 50
                  col: 17
                >
                end: <
                  line: 50
                  col: 36
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 48
                  col: 16
                >
                end: <
                  line: 48
                  col: 22
                >
              >
            >
          >
        >
      >
    >
    types: <
      key: "Pet"
      value: <
        tuple: <
          attr_defs: <
            key: "dob"
            value: <
              primitive: DATE
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 61
                  col: 15
                >
                end: <
                  line: 61
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "legRank"
            value: <
              primitive: INT
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 63
                  col: 19
                >
                end: <
                  line: 63
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 60
                  col: 16
                >
                end: <
                  line: 60
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "numLegs"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 62
                  col: 19
                >
                end: <
                  line: 62
                  col: 22
                >
              >
            >
          >
        >
      >
    >
    types: <
      key: "PetShop"
      value: <
        tuple: <
          attr_defs: <
            key: "breeds"
            value: <
              set: <
                type_ref: <
                  context: <
                    appname: <
                      part: "PetShopApi"
                    >
                    path: "PetShop"
                  >
                  ref: <
                    path: "Breed"
                  >
                >
                source_context: <
                  file: "tests/petshop.sysl"
                  start: <
                    line: 44
                    col: 18
                  >
                  end: <
                    line: 44
                    col: 25
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 44
                  col: 18
                >
                end: <
                  line: 44
                  col: 25
                >
              >
            >
          >
          attr_defs: <
            key: "employees"
            value: <
              set: <
                type_ref: <
                  context: <
                    appname: <
                      part: "PetShopApi"
                    >
                    path: "PetShop"
                  >
                  ref: <
                    path: "Employee"
                  >
                >
                source_context: <
                  file: "tests/petshop.sysl"
                  start: <
                    line: 43
                    col: 21
                  >
                  end: <
                    line: 43
                    col: 28
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 43
                  col: 21
                >
                end: <
                  line: 43
                  col: 28
                >
              >
            >
          >
          attr_defs: <
            key: "numLegs"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 45
                  col: 19
                >
                end: <
                  line: 45
                  col: 22
                >
              >
            >
          >
        >
      >
    >
  >
>
apps: <
  key: "PetShopApiToModel"
  value: <
    name: <
      part: "PetShopApiToModel"
    >
    attrs: <
      key: "package"
      value: <
        s: "io.sysl.demo.petshop.views"
      >
    >
    types: <
      key: "AnonType_0__"
      value: <
        tuple: <
          attr_defs: <
            key: "breed"
            value: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopApiToModel"
                  >
                  path: "AnonType_0__"
                >
                ref: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "Breed"
                >
              >
            >
          >
          attr_defs: <
            key: "pets"
            value: <
              set: <
                type_ref: <
                  context: <
                    appname: <
                      part: "PetShopApiToModel"
                    >
                    path: "AnonType_0__"
                  >
                  ref: <
                    appname: <
                      part: "PetShopModel"
                    >
                    path: "Pet"
                  >
                >
              >
            >
          >
        >
      >
    >
    views: <
      key: "apiToModel"
      value: <
        param: <
          name: "petshop"
          type: <
            type_ref: <
              ref: <
                appname: <
                  part: "PetShopApi"
                >
                path: "PetShop"
              >
            >
          >
        >
        ret_type: <
          type_ref: <
            context: <
              appname: <
                part: "PetShopApiToModel"
              >
            >
            ref: <
              appname: <
                part: "PetShopModel"
              >
            >
          >
        >
        expr: <
          transform: <
            arg: <
              name: "petshop"
            >
            scopevar: "."
            stmt: <
              let: <
                name: "_breedsAndPets"
                expr: <
                  transform: <
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "breeds"
                      >
                    >
                    scopevar: "."
                    stmt: <
                      let: <
                        name: "breedId"
                        expr: <
                          call: <
                            func: "autoinc"
                          >
                        >
                      >
                    >
                    stmt: <
                      assign: <
                        name: "breed"
                        expr: <
                          transform: <
                            arg: <
                              name: "."
                            >
                            scopevar: "."
                            stmt: <
                              assign: <
                                name: "breedId"
                                expr: <
                                  name: "breedId"
                                >
                              >
                            >
                            stmt: <
                              assign: <
                                name: "species"
                                expr: <
                                  get_attr: <
                                    arg: <
                                      name: "."
                                    >
                                    attr: "species"
                                  >
                                >
                              >
                            >
                            stmt: <
                              assign: <
                                name: "breedName"
                                expr: <
                                  get_attr: <
                                    arg: <
                                      name: "."
                                    >
                                    attr: "name"
                                  >
                                >
                              >
                            >
                          >
                          type: <
                            type_ref: <
                              context: <
                                appname: <
                                  part: "PetShopApiToModel"
                                >
                              >
                              ref: <
                                appname: <
                                  part: "PetShopModel"
                                >
                                path: "Breed"
                              >
                            >
                          >
                        >
                      >
                    >
                    stmt: <
                      assign: <
                        name: "pets"
                        expr: <
                          transform: <
                            arg: <
                              get_attr: <
                                arg: <
                                  name: "."
                                >
                                attr: "pets"
                              >
                            >
                            scopevar: "."
                            stmt: <
                              assign: <
                                name: "petId"
                                expr: <
                                  call: <
                                    func: "autoinc"
                                  >
                                >
                              >
                            >
                            stmt: <
                              assign: <
                                name: "breedId"
                                expr: <
                                  name: "breedId"
                                >
                              >
                            >
                            stmt: <
                              assign: <
                                name: "name"
                                expr: <
                                  get_attr: <
                                    arg: <
                                      name: "."
                                    >
                                    attr: "name"
                                  >
                                >
                              >
                            >
                            stmt: <
                              assign: <
                                name: "dob"
                                expr: <
                                  get_attr: <
                                    arg: <
                                      name: "."
                                    >
                                    attr: "dob"
                                  >
                                >
                              >
                            >
                          >
                          type: <
                            set: <
                              type_ref: <
                                context: <
                                  appname: <
                                    part: "PetShopApiToModel"
                                  >
                                >
                                ref: <
                                  appname: <
                                    part: "PetShopModel"
                                  >
                                  path: "Pet"
                                >
                              >
                            >
                          >
                        >
                      >
                    >
                  >
                  type: <
                    set: <
                      type_ref: <
                        context: <
                          appname: <
                            part: "PetShopApiToModel"
                          >
                        >
                        ref: <
                          appname: <
                            part: "PetShopApiToModel"
                          >
                          path: "AnonType_0__"
                        >
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "breedsAndPets"
                expr: <
                  relexpr: <
                    op: SNAPSHOT
                    target: <
                      name: "_breedsAndPets"
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "minId1"
                expr: <
                  relexpr: <
                    op: MAX
                    target: <
                      name: "breedsAndPets"
                    >
                    arg: <
                      get_attr: <
                        arg: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "breed"
                          >
                        >
                        attr: "breedId"
                      >
                    >
                    scopevar: "."
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "minId2"
                expr: <
                  relexpr: <
                    op: MAX
                    target: <
                      name: "breedsAndPets"
                    >
                    arg: <
                      get_attr: <
                        arg: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "breed"
                          >
                        >
                        attr: "breedId"
                      >
                    >
                    scopevar: "."
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "lee"
                expr: <
                  transform: <
                    arg: <
                      set: <
                        expr: <
                          tuple: <
                          >
                          type: <
                            tuple: <
                            >
                          >
                        >
                      >
                      type: <
                        set: <
                          tuple: <
                          >
                        >
                      >
                    >
                    scopevar: "."
                    stmt: <
                      assign: <
                        name: "name"
                        expr: <
                          literal: <
                            s: "Bruce"
                          >
                        >
                      >
                    >
                  >
                  type: <
                    set: <
                      type_ref: <
                        context: <
                          appname: <
                            part: "PetShopApiToModel"
                          >
                        >
                        ref: <
                          appname: <
                            part: "PetShopModel"
                          >
                          path: "Employee"
                        >
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "leeless"
                expr: <
                  unexpr: <
                    op: NOT
                    arg: <
                      name: "lee"
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "decimal1"
                expr: <
                  literal: <
                    decimal: "1.2"
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "decimal2"
                expr: <
                  literal: <
                    decimal: "2.3"
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "decimal3"
                expr: <
                  binexpr: <
                    op: ADD
                    lhs: <
                      unexpr: <
                        op: POS
                        arg: <
                          name: "decimal1"
                        >
                      >
                    >
                    rhs: <
                      name: "decimal2"
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "one_third"
                expr: <
                  binexpr: <
                    op: DIV
                    lhs: <
                      literal: <
                        decimal: "1.0"
                      >
                    >
                    rhs: <
                      literal: <
                        decimal: "3.0"
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "one_ninth"
                expr: <
                  binexpr: <
                    op: POW
                    lhs: <
                      name: "one_third"
                    >
                    rhs: <
                      literal: <
                        i: 2
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "bruce_lee"
                expr: <
                  binexpr: <
                    op: ADD
                    lhs: <
                      get_attr: <
                        arg: <
                          unexpr: <
                            op: SINGLE_OR_NULL
                            arg: <
                              name: "lee"
                            >
                          >
                        >
                        attr: "name"
                        nullsafe: true
                      >
                    >
                    rhs: <
                      call: <
                        func: "substr"
                        arg: <
                          literal: <
                            s: " Leek"
                          >
                        >
                        arg: <
                          literal: <
                            i: 0
                          >
                        >
                        arg: <
                          literal: <
                            i: 4
                          >
                        >
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "Employee"
                expr: <
                  transform: <
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "employees"
                      >
                    >
                    scopevar: "."
                    stmt: <
                      assign: <
                        name: "employeeId"
                        expr: <
                          call: <
                            func: "autoinc"
                          >
                        >
                      >
                    >
                    stmt: <
                      assign: <
                        name: "name"
                        expr: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "name"
                          >
                        >
                      >
                    >
                    stmt: <
                      assign: <
                        name: "dob"
                        expr: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "dob"
                          >
                        >
                      >
                    >
                    stmt: <
                      assign: <
                        name: "error"
                        expr: <
                          binexpr: <
                            op: SUB
                            lhs: <
                              name: "minId2"
                            >
                            rhs: <
                              name: "minId1"
                            >
                          >
                        >
                      >
                    >
                  >
                  type: <
                    set: <
                      type_ref: <
                        context: <
                          appname: <
                            part: "PetShopApiToModel"
                          >
                        >
                        ref: <
                          appname: <
                            part: "PetShopModel"
                          >
                          path: "Employee"
                        >
                      >
                    >
                  >
                >
                table: true
              >
            >
            stmt: <
              assign: <
                name: "Breed"
                expr: <
                  navigate: <
                    arg: <
                      name: "breedsAndPets"
                    >
                    attr: ".breed"
                    setof: true
                  >
                >
                table: true
              >
            >
            stmt: <
              assign: <
                name: "Pet"
                expr: <
                  binexpr: <
                    op: FLATTEN
                    lhs: <
                      name: "breedsAndPets"
                    >
                    rhs: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "pets"
                      >
                    >
                    scopevar: "."
                  >
                >
                table: true
              >
            >
          >
          type: <
            type_ref: <
              context: <
                appname: <
                  part: "PetShopApiToModel"
                >
              >
              ref: <
                appname: <
                  part: "PetShopModel"
                >
              >
            >
          >
        >
      >
    >
  >
>
apps: <
  key: "PetShopFacade"
  value: <
    name: <
      part: "PetShopFacade"
    >
    attrs: <
      key: "package"
      value: <
        s: "io.sysl.demo.petshop.facade"
      >
    >
    wrapped: <
      name: <
        part: "PetShopModel"
      >
      types: <
        key: "Breed"
        value: <
        >
      >
      types: <
        key: "Employee"
        value: <
        >
      >
      types: <
        key: "EmployeeTendsPet"
        value: <
        >
      >
      types: <
        key: "Pet"
        value: <
        >
      >
    >
  >
>
apps: <
  key: "PetShopModel"
  value: <
    name: <
      part: "PetShopModel"
    >
    attrs: <
      key: "package"
      value: <
        s: "io.sysl.demo.petshop.model"
      >
    >
    types: <
      key: "Breed"
      value: <
        relation: <
          attr_defs: <
            key: "avgLifespan"
            value: <
              primitive: DECIMAL
              constraint: <
                length: <
                  max: 14
                >
                precision: 14
                scale: 2
              >
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 13
                  col: 23
                >
                end: <
                  line: 13
                  col: 36
                >
              >
            >
          >
          attr_defs: <
            key: "avgWeight"
            value: <
              primitive: DECIMAL
              constraint: <
                length: <
                  max: 14
                >
              >
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 14
                  col: 21
                >
                end: <
                  line: 14
                  col: 32
                >
              >
            >
          >
          attr_defs: <
            key: "breedId"
            value: <
              primitive: INT
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "pk"
                    >
                    elt: <
                      s: "autoinc"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 9
                  col: 19
                >
                end: <
                  line: 9
                  col: 37
                >
              >
            >
          >
          attr_defs: <
            key: "breedName"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 10
                  col: 21
                >
                end: <
                  line: 10
                  col: 27
                >
              >
            >
          >
          attr_defs: <
            key: "legRank"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 15
                  col: 19
                >
                end: <
                  line: 15
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "numLegs"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 12
                  col: 19
                >
                end: <
                  line: 12
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "species"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 11
                  col: 19
                >
                end: <
                  line: 11
                  col: 25
                >
              >
            >
          >
          primary_key: <
            attr_name: "breedId"
          >
        >
      >
    >
    types: <
      key: "Employee"
      value: <
        relation: <
          attr_defs: <
            key: "dob"
            value: <
              primitive: DATE
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 5
                  col: 15
                >
                end: <
                  line: 5
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "employeeId"
            value: <
              primitive: INT
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "pk"
                    >
                    elt: <
                      s: "autoinc"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 3
                  col: 22
                >
                end: <
                  line: 3
                  col: 40
                >
              >
            >
          >
          attr_defs: <
            key: "error"
            value: <
              primitive: INT
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 6
                  col: 17
                >
                end: <
                  line: 6
                  col: 17
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 4
                  col: 16
                >
                end: <
                  line: 4
                  col: 22
                >
              >
            >
          >
          primary_key: <
            attr_name: "employeeId"
          >
        >
      >
    >
    types: <
      key: "EmployeeTendsPet"
      value: <
        relation: <
          attr_defs: <
            key: "employeeId"
            value: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "EmployeeTendsPet"
                >
                ref: <
                  path: "Employee"
                  path: "employeeId"
                >
              >
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "pk"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 25
                  col: 22
                >
                end: <
                  line: 25
                  col: 46
                >
              >
            >
          >
          attr_defs: <
            key: "petId"
            value: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "EmployeeTendsPet"
                >
                ref: <
                  path: "Pet"
                  path: "petId"
                >
              >
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "pk"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 26
                  col: 17
                >
                end: <
                  line: 26
                  col: 31
                >
              >
            >
          >
          primary_key: <
            attr_name: "employeeId"
            attr_name: "petId"
          >
        >
      >
    >
    types: <
      key: "Pet"
      value: <
        relation: <
          attr_defs: <
            key: "breedId"
            value: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "Pet"
                >
                ref: <
                  path: "Breed"
                  path: "breedId"
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 19
                  col: 19
                >
                end: <
                  line: 19
                  col: 25
                >
              >
            >
          >
          attr_defs: <
            key: "dob"
            value: <
              primitive: DATE
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 21
                  col: 15
                >
                end: <
                  line: 21
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 20
                  col: 16
                >
                end: <
                  line: 20
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "numLegs"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 22
                  col: 19
                >
                end: <
                  line: 22
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "petId"
            value: <
              primitive: INT
              attrs: <
                key: "patterns"
                value: <
                  a: <
                    elt: <
                      s: "pk"
                    >
                    elt: <
                      s: "autoinc"
                    >
                  >
                >
              >
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 18
                  col: 17
                >
                end: <
                  line: 18
                  col: 35
                >
              >
            >
          >
          primary_key: <
            attr_name: "petId"
          >
        >
      >
    >
  >
>
apps: <
  key: "PetShopModelToApi"
  value: <
    name: <
      part: "PetShopModelToApi"
    >
    attrs: <
      key: "package"
      value: <
        s: "io.sysl.demo.petshop.views"
      >
    >
    types: <
      key: "PetRankedByLeg"
      value: <
        tuple: <
          attr_defs: <
            key: "breedId"
            value: <
              primitive: INT
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 117
                  col: 19
                >
                end: <
                  line: 117
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "dob"
            value: <
              primitive: DATE
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 119
                  col: 15
                >
                end: <
                  line: 119
                  col: 19
                >
              >
            >
          >
          attr_defs: <
            key: "legRank"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 121
                  col: 19
                >
                end: <
                  line: 121
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "name"
            value: <
              primitive: STRING
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 118
                  col: 16
                >
                end: <
                  line: 118
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "numLegs"
            value: <
              primitive: INT
              opt: true
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 120
                  col: 19
                >
                end: <
                  line: 120
                  col: 22
                >
              >
            >
          >
          attr_defs: <
            key: "petId"
            value: <
              primitive: INT
              source_context: <
                file: "tests/petshop.sysl"
                start: <
                  line: 116
                  col: 17
                >
                end: <
                  line: 116
                  col: 17
                >
              >
            >
          >
        >
      >
    >
    views: <
      key: "breedToApi"
      value: <
        param: <
          name: "breed"
          type: <
            set: <
              type_ref: <
                ref: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "Breed"
                >
              >
            >
          >
        >
        param: <
          name: "pet"
          type: <
            set: <
              type_ref: <
                ref: <
                  appname: <
                    part: "PetShopModelToApi"
                  >
                  path: "PetRankedByLeg"
                >
              >
            >
          >
        >
        ret_type: <
          set: <
            type_ref: <
              context: <
                appname: <
                  part: "PetShopModelToApi"
                >
              >
              ref: <
                appname: <
                  part: "PetShopApi"
                >
                path: "Breed"
              >
            >
          >
        >
        expr: <
          transform: <
            arg: <
              name: "breed"
            >
            scopevar: "."
            stmt: <
              assign: <
                name: "name"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "breedName"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "species"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "species"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "pets"
                expr: <
                  call: <
                    func: "petToApi"
                    arg: <
                      binexpr: <
                        op: TO_MATCHING
                        lhs: <
                          navigate: <
                            arg: <
                              name: "."
                            >
                            attr: "Pet"
                            setof: true
                          >
                        >
                        rhs: <
                          name: "pet"
                        >
                        attr_name: "petId"
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "avgLifespan"
                expr: <
                  unexpr: <
                    op: NEG
                    arg: <
                      literal: <
                        decimal: "1.0"
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "index"
                expr: <
                  call: <
                    func: "autoinc"
                    arg: <
                      literal: <
                        s: "Breed"
                      >
                    >
                  >
                >
              >
            >
          >
          type: <
            set: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModelToApi"
                  >
                >
                ref: <
                  appname: <
                    part: "PetShopApi"
                  >
                  path: "Breed"
                >
              >
            >
          >
        >
      >
    >
    views: <
      key: "employeeToApi"
      value: <
        param: <
          name: "employee"
          type: <
            set: <
              type_ref: <
                ref: <
                  appname: <
                    part: "PetShopModel"
                  >
                  path: "Employee"
                >
              >
            >
          >
        >
        ret_type: <
          set: <
            type_ref: <
              context: <
                appname: <
                  part: "PetShopModelToApi"
                >
              >
              ref: <
                appname: <
                  part: "PetShopApi"
                >
                path: "Employee"
              >
            >
          >
        >
        expr: <
          transform: <
            arg: <
              name: "employee"
            >
            scopevar: "."
            stmt: <
              assign: <
                name: "name"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "name"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "dob"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "dob"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "index"
                expr: <
                  call: <
                    func: "autoinc"
                    arg: <
                      literal: <
                        s: "Employee"
                      >
                    >
                  >
                >
              >
            >
          >
          type: <
            set: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModelToApi"
                  >
                >
                ref: <
                  appname: <
                    part: "PetShopApi"
                  >
                  path: "Employee"
                >
              >
            >
          >
        >
      >
    >
    views: <
      key: "fibonacci"
      value: <
        param: <
          name: "n"
          type: <
            primitive: INT
          >
        >
        ret_type: <
          primitive: INT
        >
        attrs: <
          key: "patterns"
          value: <
            a: <
              elt: <
                s: "abstract"
              >
            >
          >
        >
      >
    >
    views: <
      key: "modelToApi"
      value: <
        param: <
          name: "petshop"
          type: <
            type_ref: <
              ref: <
                appname: <
                  part: "PetShopModel"
                >
              >
            >
          >
        >
        ret_type: <
          type_ref: <
            context: <
              appname: <
                part: "PetShopModelToApi"
              >
            >
            ref: <
              appname: <
                part: "PetShopApi"
              >
              path: "PetShop"
            >
          >
        >
        expr: <
          transform: <
            arg: <
              name: "petshop"
            >
            scopevar: "."
            stmt: <
              let: <
                name: "rankedPets"
                expr: <
                  relexpr: <
                    op: RANK
                    target: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Pet"
                        setof: true
                      >
                    >
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "numLegs"
                      >
                    >
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "numLegs"
                      >
                    >
                    scopevar: "."
                    descending: false
                    attr_name: "legRank"
                  >
                  type: <
                    set: <
                      type_ref: <
                        ref: <
                          appname: <
                            part: "PetShopModelToApi"
                          >
                          path: "PetRankedByLeg"
                        >
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "employees"
                expr: <
                  call: <
                    func: "employeeToApi"
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Employee"
                        setof: true
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "breeds"
                expr: <
                  call: <
                    func: "breedToApi"
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Breed"
                        setof: true
                      >
                    >
                    arg: <
                      name: "rankedPets"
                    >
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "numLegs"
                expr: <
                  relexpr: <
                    op: SUM
                    target: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Pet"
                        setof: true
                      >
                    >
                    arg: <
                      binexpr: <
                        op: COALESCE
                        lhs: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "numLegs"
                          >
                        >
                        rhs: <
                          literal: <
                            i: 0
                          >
                        >
                      >
                    >
                    scopevar: "."
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "m"
                expr: <
                  relexpr: <
                    op: MIN
                    target: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Pet"
                        setof: true
                      >
                    >
                    arg: <
                      binexpr: <
                        op: COALESCE
                        lhs: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "numLegs"
                          >
                        >
                        rhs: <
                          literal: <
                            i: 0
                          >
                        >
                      >
                    >
                    scopevar: "."
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "a"
                expr: <
                  relexpr: <
                    op: AVERAGE
                    target: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Pet"
                        setof: true
                      >
                    >
                    arg: <
                      binexpr: <
                        op: COALESCE
                        lhs: <
                          get_attr: <
                            arg: <
                              name: "."
                            >
                            attr: "numLegs"
                          >
                        >
                        rhs: <
                          literal: <
                            i: 0
                          >
                        >
                      >
                    >
                    scopevar: "."
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "pp"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "Pet"
                    setof: true
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "bb"
                expr: <
                  binexpr: <
                    op: TO_MATCHING
                    lhs: <
                      name: "pp"
                    >
                    rhs: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Breed"
                        setof: true
                      >
                    >
                    attr_name: "*"
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "yy"
                expr: <
                  binexpr: <
                    op: TO_NOT_MATCHING
                    lhs: <
                      name: "pp"
                    >
                    rhs: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "Breed"
                        setof: true
                      >
                    >
                    attr_name: "*"
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "p"
                expr: <
                  unexpr: <
                    op: SINGLE_OR_NULL
                    arg: <
                      call: <
                        func: ".any"
                        arg: <
                          name: "pp"
                        >
                        arg: <
                          literal: <
                            i: 1
                          >
                        >
                      >
                    >
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "b"
                expr: <
                  navigate: <
                    arg: <
                      name: "p"
                    >
                    attr: "Breed"
                  >
                >
              >
            >
            stmt: <
              let: <
                name: "pp2"
                expr: <
                  navigate: <
                    arg: <
                      name: "b"
                    >
                    attr: "Pet"
                    nullsafe: true
                    setof: true
                  >
                >
              >
            >
          >
          type: <
            type_ref: <
              context: <
                appname: <
                  part: "PetShopModelToApi"
                >
              >
              ref: <
                appname: <
                  part: "PetShopApi"
                >
                path: "PetShop"
              >
            >
          >
        >
      >
    >
    views: <
      key: "petToApi"
      value: <
        param: <
          name: "pet"
          type: <
            set: <
              type_ref: <
                ref: <
                  appname: <
                    part: "PetShopModelToApi"
                  >
                  path: "PetRankedByLeg"
                >
              >
            >
          >
        >
        ret_type: <
          set: <
            type_ref: <
              context: <
                appname: <
                  part: "PetShopModelToApi"
                >
              >
              ref: <
                appname: <
                  part: "PetShopApi"
                >
                path: "Pet"
              >
            >
          >
        >
        expr: <
          transform: <
            arg: <
              name: "pet"
            >
            scopevar: "."
            stmt: <
              assign: <
                name: "name"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "name"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "dob"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "dob"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "numLegs"
                expr: <
                  get_attr: <
                    arg: <
                      name: "."
                    >
                    attr: "numLegs"
                  >
                >
              >
            >
            stmt: <
              assign: <
                name: "legRank"
                expr: <
                  call: <
                    func: "fibonacci"
                    arg: <
                      get_attr: <
                        arg: <
                          name: "."
                        >
                        attr: "legRank"
                      >
                    >
                  >
                >
              >
            >
          >
          type: <
            set: <
              type_ref: <
                context: <
                  appname: <
                    part: "PetShopModelToApi"
                  >
                >
                ref: <
                  appname: <
                    part: "PetShopApi"
                  >
                  path: "Pet"
                >
              >
            >
          >
        >
      >
    >
  >
>
