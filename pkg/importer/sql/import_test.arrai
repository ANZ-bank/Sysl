let (:import, ...) = //{./import};

let upSqlsIn = \dir //os.tree(dir) where //seq.has_suffix('.up.sql', .path) => .path orderby .;

# Assume working directory is repo root.
let testDir = 'pkg/importer/sql/tests';

let simple = $`
    # Code generated by Sysl. DO NOT EDIT.

    Foo:
        !table foo:
            a <: int64? [~pk]

`;

(
    mysql: (
        import: (
            file: import('Foo', $'${testDir}/mysql/migrations/01_create_foo.up.sql') = simple,
            files: import('Foo', upSqlsIn($'${testDir}/mysql/migrations')) = simple,
            migrations: import('Foo', $'${testDir}/mysql/migrations') = simple,
        ),
    ),
    postgresql: (
        import: (
            file: import('Foo', $'${testDir}/postgresql/migrations/01_create_foo.up.sql') = simple,
            files: import('Foo', upSqlsIn($'${testDir}/postgresql/migrations')) = simple,
            migrations: import('Foo', $'${testDir}/postgresql/migrations') = simple,
        ),
    ),

    spanner: (
        import: (
            file: import('Foo', $'${testDir}/spanner/migrations/01_create_foo.up.sql') = simple,
            files: import('Foo', upSqlsIn($'${testDir}/spanner/migrations')) = simple,
            migrations: import('Foo', $'${testDir}/spanner/migrations') = simple,
        ),
    ),
)
